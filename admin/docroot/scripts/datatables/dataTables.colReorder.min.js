/*!
 ColReorder 1.1.0
 Â©2010-2014 SpryMedia Ltd - datatables.net/license
*/
(function(n,p,q){function m(a){for(var f=[],c=0,d=a.length;c<d;c++)f[a[c]]=c;return f}function j(a,f,c){f=a.splice(f,1)[0];a.splice(c,0,f)}function o(a,f,c){for(var d=[],b=0,e=a.childNodes.length;b<e;b++)1==a.childNodes[b].nodeType&&d.push(a.childNodes[b]);f=d[f];null!==c?a.insertBefore(f,d[c]):a.appendChild(f)}$.fn.dataTableExt.oApi.fnColReorder=function(a,f,c){var d=$.fn.dataTable.Api?!0:!1,b,e,h,i,k=a.aoColumns.length,g;if(f!=c)if(0>f||f>=k)this.oApi._fnLog(a,1,"ColReorder 'from' index is out of bounds: "+
f);else if(0>c||c>=k)this.oApi._fnLog(a,1,"ColReorder 'to' index is out of bounds: "+c);else{h=[];b=0;for(e=k;b<e;b++)h[b]=b;j(h,f,c);var l=m(h);b=0;for(e=a.aaSorting.length;b<e;b++)a.aaSorting[b][0]=l[a.aaSorting[b][0]];if(null!==a.aaSortingFixed){b=0;for(e=a.aaSortingFixed.length;b<e;b++)a.aaSortingFixed[b][0]=l[a.aaSortingFixed[b][0]]}b=0;for(e=k;b<e;b++){g=a.aoColumns[b];h=0;for(i=g.aDataSort.length;h<i;h++)g.aDataSort[h]=l[g.aDataSort[h]];d&&(g.idx=l[g.idx])}d&&$.each(a.aLastSort,function(b,
c){a.aLastSort[b].src=l[c.src]});b=0;for(e=k;b<e;b++)g=a.aoColumns[b],"number"==typeof g.mData&&(g.mData=l[g.mData],a.oApi._fnColumnOptions(a,b,{}));if(a.aoColumns[f].bVisible){i=this.oApi._fnColumnIndexToVisible(a,f);g=null;for(b=c<f?c:c+1;null===g&&b<k;)g=this.oApi._fnColumnIndexToVisible(a,b),b++;h=a.nTHead.getElementsByTagName("tr");b=0;for(e=h.length;b<e;b++)o(h[b],i,g);if(null!==a.nTFoot){h=a.nTFoot.getElementsByTagName("tr");b=0;for(e=h.length;b<e;b++)o(h[b],i,g)}b=0;for(e=a.aoData.length;b<
e;b++)null!==a.aoData[b].nTr&&o(a.aoData[b].nTr,i,g)}j(a.aoColumns,f,c);j(a.aoPreSearchCols,f,c);b=0;for(e=a.aoData.length;b<e;b++)d?j(a.aoData[b].anCells,f,c):($.isArray(a.aoData[b]._aData)&&j(a.aoData[b]._aData,f,c),j(a.aoData[b]._anHidden,f,c));b=0;for(e=a.aoHeader.length;b<e;b++)j(a.aoHeader[b],f,c);if(null!==a.aoFooter){b=0;for(e=a.aoFooter.length;b<e;b++)j(a.aoFooter[b],f,c)}d&&(new $.fn.dataTable.Api(a)).rows().invalidate();b=0;for(e=k;b<e;b++)$(a.aoColumns[b].nTh).off("click.DT"),this.oApi._fnSortAttachListener(a,
a.aoColumns[b].nTh,b);$(a.oInstance).trigger("column-reorder",[a,{iFrom:f,iTo:c,aiInvertMapping:l}])}};n=function(a){var f=function(c,d){var b;a.fn.dataTable.Api?b=(new a.fn.dataTable.Api(c)).settings()[0]:c.fnSettings?b=c.fnSettings():"string"===typeof c?a.fn.dataTable.fnIsDataTable(a(c)[0])&&(b=a(c).eq(0).dataTable().fnSettings()):c.nodeName&&"table"===c.nodeName.toLowerCase()?a.fn.dataTable.fnIsDataTable(c.nodeName)&&(b=a(c.nodeName).dataTable().fnSettings()):c instanceof jQuery?a.fn.dataTable.fnIsDataTable(c[0])&&
(b=c.eq(0).dataTable().fnSettings()):b=c;a.fn.dataTable.camelToHungarian&&a.fn.dataTable.camelToHungarian(f.defaults,d||{});this.s={dt:null,init:a.extend(!0,{},f.defaults,d),fixed:0,fixedRight:0,dropCallback:null,mouse:{startX:-1,startY:-1,offsetX:-1,offsetY:-1,target:-1,targetIndex:-1,fromIndex:-1},aoTargets:[]};this.dom={drag:null,pointer:null};this.s.dt=b.oInstance.fnSettings();this.s.dt._colReorder=this;this._fnConstruct();b.oApi._fnCallbackReg(b,"aoDestroyCallback",a.proxy(this._fnDestroy,this),
"ColReorder");return this};f.prototype={fnReset:function(){for(var c=[],a=0,b=this.s.dt.aoColumns.length;a<b;a++)c.push(this.s.dt.aoColumns[a]._ColReorder_iOrigCol);this._fnOrderColumns(c);return this},fnGetCurrentOrder:function(){return this.fnOrder()},fnOrder:function(c){if(c===q){for(var c=[],a=0,b=this.s.dt.aoColumns.length;a<b;a++)c.push(this.s.dt.aoColumns[a]._ColReorder_iOrigCol);return c}this._fnOrderColumns(m(c));return this},_fnConstruct:function(){var c=this,a=this.s.dt.aoColumns.length,
b;this.s.init.iFixedColumns&&(this.s.fixed=this.s.init.iFixedColumns);this.s.fixedRight=this.s.init.iFixedColumnsRight?this.s.init.iFixedColumnsRight:0;this.s.init.fnReorderCallback&&(this.s.dropCallback=this.s.init.fnReorderCallback);for(b=0;b<a;b++)b>this.s.fixed-1&&b<a-this.s.fixedRight&&this._fnMouseListener(b,this.s.dt.aoColumns[b].nTh),this.s.dt.aoColumns[b]._ColReorder_iOrigCol=b;this.s.dt.oApi._fnCallbackReg(this.s.dt,"aoStateSaveParams",function(b,a){c._fnStateSave.call(c,a)},"ColReorder_State");
var e=null;this.s.init.aiOrder&&(e=this.s.init.aiOrder.slice());this.s.dt.oLoadedState&&("undefined"!=typeof this.s.dt.oLoadedState.ColReorder&&this.s.dt.oLoadedState.ColReorder.length==this.s.dt.aoColumns.length)&&(e=this.s.dt.oLoadedState.ColReorder);if(e)if(c.s.dt._bInitComplete)a=m(e),c._fnOrderColumns.call(c,a);else{var f=!1;this.s.dt.aoDrawCallback.push({fn:function(){if(!c.s.dt._bInitComplete&&!f){f=true;var b=m(e);c._fnOrderColumns.call(c,b)}},sName:"ColReorder_Pre"})}else this._fnSetColumnIndexes()},
_fnOrderColumns:function(c){if(c.length!=this.s.dt.aoColumns.length)this.s.dt.oInstance.oApi._fnLog(this.s.dt,1,"ColReorder - array reorder does not match known number of columns. Skipping.");else{for(var d=0,b=c.length;d<b;d++){var e=a.inArray(d,c);d!=e&&(j(c,e,d),this.s.dt.oInstance.fnColReorder(e,d))}(""!==this.s.dt.oScroll.sX||""!==this.s.dt.oScroll.sY)&&this.s.dt.oInstance.fnAdjustColumnSizing();this.s.dt.oInstance.oApi._fnSaveState(this.s.dt);this._fnSetColumnIndexes()}},_fnStateSave:function(c){var d,
b,e,f=this.s.dt;for(d=0;d<c.aaSorting.length;d++)c.aaSorting[d][0]=f.aoColumns[c.aaSorting[d][0]]._ColReorder_iOrigCol;var i=a.extend(!0,[],c.aoSearchCols);c.ColReorder=[];d=0;for(b=f.aoColumns.length;d<b;d++)e=f.aoColumns[d]._ColReorder_iOrigCol,c.aoSearchCols[e]=i[d],c.abVisCols[e]=f.aoColumns[d].bVisible,c.ColReorder.push(e)},_fnMouseListener:function(c,d){var b=this;a(d).on("mousedown.ColReorder",function(a){a.preventDefault();b._fnMouseDown.call(b,a,d)})},_fnMouseDown:function(c,d){var b=this,
e=a(c.target).closest("th, td").offset(),f=parseInt(a(d).attr("data-column-index"),10);f!==q&&(this.s.mouse.startX=c.pageX,this.s.mouse.startY=c.pageY,this.s.mouse.offsetX=c.pageX-e.left,this.s.mouse.offsetY=c.pageY-e.top,this.s.mouse.target=this.s.dt.aoColumns[f].nTh,this.s.mouse.targetIndex=f,this.s.mouse.fromIndex=f,this._fnRegions(),a(p).on("mousemove.ColReorder",function(a){b._fnMouseMove.call(b,a)}).on("mouseup.ColReorder",function(a){b._fnMouseUp.call(b,a)}))},_fnMouseMove:function(a){if(null===
this.dom.drag){if(5>Math.pow(Math.pow(a.pageX-this.s.mouse.startX,2)+Math.pow(a.pageY-this.s.mouse.startY,2),0.5))return;this._fnCreateDragNode()}this.dom.drag.css({left:a.pageX-this.s.mouse.offsetX,top:a.pageY-this.s.mouse.offsetY});for(var d=!1,b=this.s.mouse.toIndex,e=1,f=this.s.aoTargets.length;e<f;e++)if(a.pageX<this.s.aoTargets[e-1].x+(this.s.aoTargets[e].x-this.s.aoTargets[e-1].x)/2){this.dom.pointer.css("left",this.s.aoTargets[e-1].x);this.s.mouse.toIndex=this.s.aoTargets[e-1].to;d=!0;break}d||
(this.dom.pointer.css("left",this.s.aoTargets[this.s.aoTargets.length-1].x),this.s.mouse.toIndex=this.s.aoTargets[this.s.aoTargets.length-1].to);this.s.init.bRealtime&&b!==this.s.mouse.toIndex&&(this.s.dt.oInstance.fnColReorder(this.s.mouse.fromIndex,this.s.mouse.toIndex),this.s.mouse.fromIndex=this.s.mouse.toIndex,this._fnRegions())},_fnMouseUp:function(){a(p).off("mousemove.ColReorder mouseup.ColReorder");null!==this.dom.drag&&(this.dom.drag.remove(),this.dom.pointer.remove(),this.dom.drag=null,
this.dom.pointer=null,this.s.dt.oInstance.fnColReorder(this.s.mouse.fromIndex,this.s.mouse.toIndex),this._fnSetColumnIndexes(),(""!==this.s.dt.oScroll.sX||""!==this.s.dt.oScroll.sY)&&this.s.dt.oInstance.fnAdjustColumnSizing(),null!==this.s.dropCallback&&this.s.dropCallback.call(this),this.s.dt.oInstance.oApi._fnSaveState(this.s.dt))},_fnRegions:function(){var c=this.s.dt.aoColumns;this.s.aoTargets.splice(0,this.s.aoTargets.length);this.s.aoTargets.push({x:a(this.s.dt.nTable).offset().left,to:0});
for(var d=0,b=0,e=c.length;b<e;b++)b!=this.s.mouse.fromIndex&&d++,c[b].bVisible&&this.s.aoTargets.push({x:a(c[b].nTh).offset().left+a(c[b].nTh).outerWidth(),to:d});0!==this.s.fixedRight&&this.s.aoTargets.splice(this.s.aoTargets.length-this.s.fixedRight);0!==this.s.fixed&&this.s.aoTargets.splice(0,this.s.fixed)},_fnCreateDragNode:function(){var c=""!==this.s.dt.oScroll.sX||""!==this.s.dt.oScroll.sY,d=this.s.dt.aoColumns[this.s.mouse.targetIndex].nTh,b=d.parentNode,e=b.parentNode,f=e.parentNode,i=a(d).clone();
this.dom.drag=a(f.cloneNode(!1)).addClass("DTCR_clonedTable").append(e.cloneNode(!1).appendChild(b.cloneNode(!1).appendChild(i[0]))).css({position:"absolute",top:0,left:0,width:a(d).outerWidth(),height:a(d).outerHeight()}).appendTo("body");this.dom.pointer=a("<div></div>").addClass("DTCR_pointer").css({position:"absolute",top:c?a("div.dataTables_scroll",this.s.dt.nTableWrapper).offset().top:a(this.s.dt.nTable).offset().top,height:c?a("div.dataTables_scroll",this.s.dt.nTableWrapper).height():a(this.s.dt.nTable).height()}).appendTo("body")},
_fnDestroy:function(){var c,d;c=0;for(d=this.s.dt.aoDrawCallback.length;c<d;c++)if("ColReorder_Pre"===this.s.dt.aoDrawCallback[c].sName){this.s.dt.aoDrawCallback.splice(c,1);break}a(this.s.dt.nTHead).find("*").off(".ColReorder");a.each(this.s.dt.aoColumns,function(b,c){a(c.nTh).removeAttr("data-column-index")});this.s=this.s.dt._colReorder=null},_fnSetColumnIndexes:function(){a.each(this.s.dt.aoColumns,function(c,d){a(d.nTh).attr("data-column-index",c)})}};f.defaults={aiOrder:null,bRealtime:!1,iFixedColumns:0,
iFixedColumnsRight:0,fnReorderCallback:null};f.version="1.1.0";a.fn.dataTable.ColReorder=f;a.fn.DataTable.ColReorder=f;"function"==typeof a.fn.dataTable&&"function"==typeof a.fn.dataTableExt.fnVersionCheck&&a.fn.dataTableExt.fnVersionCheck("1.9.3")?a.fn.dataTableExt.aoFeatures.push({fnInit:function(a){var d=a.oInstance;a._colReorder?d.oApi._fnLog(a,1,"ColReorder attempted to initialise twice. Ignoring second"):(d=a.oInit,new f(a,d.colReorder||d.oColReorder||{}));return null},cFeature:"R",sFeature:"ColReorder"}):
alert("Warning: ColReorder requires DataTables 1.9.3 or greater - www.datatables.net/download");a.fn.dataTable.Api&&(a.fn.dataTable.Api.register("colReorder.reset()",function(){return this.iterator("table",function(a){a._colReorder.fnReset()})}),a.fn.dataTable.Api.register("colReorder.order()",function(a){return a?this.iterator("table",function(d){d._colReorder.fnOrder(a)}):this.context.length?this.context[0]._colReorder.fnOrder():null}));return f};"function"===typeof define&&define.amd?define("datatables-colreorder",
["jquery","datatables"],n):jQuery&&!jQuery.fn.dataTable.ColReorder&&n(jQuery,jQuery.fn.dataTable)})(window,document);
